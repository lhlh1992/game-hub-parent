# 前端页面流程与入口设计

## 📋 一、当前问题分析

### 1.1 现状问题

1. **前端页面位置混乱**
   - ❌ 所有前端页面都在 `game-service` 的 `static` 目录下
   - ❌ 前端代码与后端服务耦合，不符合前后端分离原则
   - ❌ 页面路由混乱：`index.html` → `lobby.html`，Gateway 根路径也跳转到 `lobby.html`

2. **入口设计不清晰**
   - ❌ 没有真正的"首页"（Homepage）
   - ❌ `lobby.html` 既是入口又是游戏大厅，职责不清
   - ❌ 所有页面都要求登录，没有"游客浏览"的概念

3. **登录策略不明确**
   - ❌ 未登录用户无法看到任何内容
   - ❌ 缺少"先浏览后登录"的用户体验
   - ❌ 没有区分"公开页面"和"需要登录的页面"

---

## 🎯 二、设计目标

### 2.1 核心原则

1. **前后端分离**
   - 前端作为独立应用（未来迁移到 React）
   - 后端只提供 API，不提供 HTML 页面（或仅提供静态资源服务）

2. **渐进式登录**
   - 首页允许未登录用户浏览
   - 核心功能（游戏、个人中心）需要登录
   - 提供清晰的登录入口和引导

3. **清晰的页面划分**
   - **首页（Homepage）**：平台介绍、游戏列表、登录入口
   - **游戏大厅（Lobby）**：需要登录，创建/加入房间
   - **游戏房间（Game Room）**：需要登录，进行游戏
   - **个人中心（Profile）**：需要登录，用户信息、战绩

---

## 🏗️ 三、页面流程设计

### 3.1 页面结构

```
┌─────────────────────────────────────────────────────────┐
│                    首页 (Homepage)                        │
│  - 平台介绍、游戏列表、特色功能                          │
│  - 登录/注册入口                                         │
│  - 未登录可浏览，登录后显示用户信息                      │
└─────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  游戏大厅    │  │   个人中心   │  │   关于我们   │
│ (Lobby)     │  │  (Profile)  │  │   (About)  │
│             │  │             │  │             │
│ 需要登录    │  │  需要登录    │  │  公开页面   │
└─────────────┘  └─────────────┘  └─────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────┐
│                  游戏房间 (Game Room)                     │
│  - 游戏进行中                                            │
│  - 需要登录 + 房间权限验证                               │
└─────────────────────────────────────────────────────────┘
```

### 3.2 页面路由设计

| 路径 | 页面 | 是否需要登录 | 说明 |
|------|------|------------|------|
| `/` | 首页 (Homepage) | ❌ 否 | 平台介绍、游戏列表、登录入口 |
| `/lobby` | 游戏大厅 | ✅ 是 | 创建/加入房间、房间列表 |
| `/game/:roomId` | 游戏房间 | ✅ 是 | 进行游戏 |
| `/profile` | 个人中心 | ✅ 是 | 用户信息、战绩、设置 |
| `/profile/:userId` | 用户主页 | ❌ 否 | 公开的用户信息（战绩、等级） |
| `/about` | 关于我们 | ❌ 否 | 平台介绍、规则说明 |
| `/login` | 登录页 | ❌ 否 | 登录/注册入口（或直接跳转 Keycloak） |

---

## 🔐 四、登录策略设计

### 4.1 登录策略分类

#### 策略 A：渐进式登录（推荐）⭐

**特点**：
- 首页允许未登录用户浏览
- 核心功能需要登录
- 提供清晰的登录引导

**页面权限**：
```
公开页面（无需登录）：
  - / (首页)
  - /about (关于)
  - /profile/:userId (公开用户主页)

需要登录的页面：
  - /lobby (游戏大厅)
  - /game/:roomId (游戏房间)
  - /profile (个人中心)
  - /settings (设置)
```

**用户体验流程**：
1. 用户访问 `/` → 看到首页，可以浏览游戏列表
2. 用户点击"开始游戏" → 检测未登录 → 跳转登录 → 登录后回到目标页面
3. 用户已登录 → 首页显示用户信息，可直接进入大厅

**优点**：
- ✅ 用户体验好，降低进入门槛
- ✅ 符合现代 Web 应用习惯
- ✅ 便于 SEO 和分享

**缺点**：
- ⚠️ 需要处理登录状态判断和跳转逻辑

---

#### 策略 B：强制登录（当前方案）

**特点**：
- 所有页面都需要登录
- 未登录直接跳转登录页

**页面权限**：
```
所有页面都需要登录：
  - / (首页) → 需要登录
  - /lobby → 需要登录
  - /game/:roomId → 需要登录
```

**用户体验流程**：
1. 用户访问任何页面 → 检测未登录 → 跳转登录
2. 登录后 → 跳转到目标页面

**优点**：
- ✅ 实现简单，权限控制统一
- ✅ 适合内部系统或封闭平台

**缺点**：
- ❌ 用户体验差，进入门槛高
- ❌ 无法分享链接给未登录用户
- ❌ 不利于 SEO

---

### 4.2 推荐方案：渐进式登录

**理由**：
1. 符合现代 Web 应用标准（GitHub、Steam、Chess.com 都采用此策略）
2. 用户体验更好，降低进入门槛
3. 便于未来扩展（分享、SEO、营销页面）

---

## 🏠 五、首页内容设计

### 5.1 首页布局（未登录状态）

```
┌─────────────────────────────────────────────────────────┐
│  导航栏: [Logo] [游戏] [关于] [登录] [注册]              │
├─────────────────────────────────────────────────────────┤
│                                                          │
│   Hero 区域                                              │
│   ┌──────────────────────────────────────────────┐     │
│   │  大标题: 多人在线棋牌平台                      │     │
│   │  副标题: 与好友一起享受棋类游戏的乐趣          │     │
│   │  [立即开始] 按钮 → 跳转登录                   │     │
│   └──────────────────────────────────────────────┘     │
│                                                          │
│  游戏列表区域                                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 五子棋   │  │  象棋    │  │  围棋    │             │
│  │ [开始]   │  │ [开始]   │  │ [开始]   │             │
│  └──────────┘  └──────────┘  └──────────┘             │
│                                                          │
│  特色功能区域                                            │
│  - 实时对战                                              │
│  - AI 陪练                                               │
│  - 好友系统                                              │
│  - 战绩排行                                              │
│                                                          │
│  页脚: 关于我们 | 隐私政策 | 联系我们                    │
└─────────────────────────────────────────────────────────┘
```

### 5.2 首页布局（已登录状态）

```
┌─────────────────────────────────────────────────────────┐
│  导航栏: [Logo] [游戏大厅] [个人中心] [用户名▼] [退出]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  欢迎区域                                                │
│  ┌──────────────────────────────────────────────┐     │
│  │  欢迎回来，{用户名}！                          │     │
│  │  当前等级: {等级} | 积分: {积分} | 胜率: {胜率}│     │
│  │  [进入游戏大厅] 按钮                           │     │
│  └──────────────────────────────────────────────┘     │
│                                                          │
│  快速开始区域                                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 快速匹配 │  │ 创建房间 │  │ 好友对战 │             │
│  │ [匹配]   │  │ [创建]   │  │ [邀请]   │             │
│  └──────────┘  └──────────┘  └──────────┘             │
│                                                          │
│  最近对局区域                                            │
│  - 最近 5 局对局记录                                     │
│  - [查看全部战绩]                                        │
│                                                          │
│  好友动态区域（可选）                                    │
│  - 好友在线状态                                          │
│  - 好友最近对局                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🗂️ 六、前后端分离架构设计

### 6.1 方案对比

#### 方案 A：独立前端服务（推荐，未来迁移到 React）⭐

**架构**：
```
┌─────────────┐
│  浏览器      │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────────┐
│  Gateway (8080)                     │
│  ┌───────────────────────────────┐ │
│  │  静态资源服务 (前端应用)        │ │
│  │  - / → index.html (React SPA) │ │
│  │  - /static/** → 静态资源       │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │  API 路由                     │ │
│  │  - /api/** → 后端服务         │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
       │
       ├──→ game-service (8081)
       ├──→ system-service (8082)
       └──→ 其他服务
```

**目录结构**：
```
game-hub-parent/
├── apps/
│   ├── gateway/          # 网关（路由 + 静态资源服务）
│   ├── game-service/     # 游戏服务（只提供 API）
│   └── system-service/   # 系统服务（只提供 API）
└── frontend/             # 独立前端项目（未来）
    ├── public/
    ├── src/
    │   ├── pages/
    │   │   ├── HomePage.tsx
    │   │   ├── LobbyPage.tsx
    │   │   ├── GameRoomPage.tsx
    │   │   └── ProfilePage.tsx
    │   ├── components/
    │   ├── services/     # API 调用
    │   └── utils/
    └── package.json
```

**优点**：
- ✅ 前后端完全分离
- ✅ 便于未来迁移到 React
- ✅ 前端可以独立部署和开发
- ✅ 符合现代 Web 应用架构

**缺点**：
- ⚠️ 需要配置静态资源服务（Gateway 或 Nginx）
- ⚠️ 需要处理 SPA 路由（History API）

---

#### 方案 B：Gateway 静态资源服务（当前阶段过渡方案）

**架构**：
```
┌─────────────┐
│  浏览器      │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────────┐
│  Gateway (8080)                     │
│  ┌───────────────────────────────┐ │
│  │  静态资源路由                  │ │
│  │  - / → index.html             │ │
│  │  - /static/** → 静态资源       │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │  API 路由                     │ │
│  │  - /api/** → 后端服务         │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

**目录结构**：
```
game-hub-parent/
├── apps/
│   ├── gateway/
│   │   └── src/main/resources/
│   │       └── static/          # 前端静态资源
│   │           ├── index.html   # 首页
│   │           ├── lobby.html   # 游戏大厅
│   │           ├── game.html    # 游戏房间
│   │           ├── css/
│   │           └── js/
│   ├── game-service/             # 只提供 API
│   └── system-service/           # 只提供 API
```

**优点**：
- ✅ 实现简单，无需额外配置
- ✅ 适合当前阶段（原生 HTML/JS）
- ✅ 便于快速迭代

**缺点**：
- ❌ 前端代码仍在后端项目中
- ❌ 未来迁移到 React 需要重构

---

### 6.2 推荐方案：分阶段实施

**阶段 1（当前）**：Gateway 静态资源服务
- 将前端页面从 `game-service` 迁移到 `gateway/static`
- 实现首页、游戏大厅、游戏房间的页面划分
- 实现渐进式登录策略

**阶段 2（未来）**：独立前端服务
- 创建独立的 `frontend` 项目
- 迁移到 React + TypeScript
- Gateway 或 Nginx 提供静态资源服务

---

## 🛣️ 七、Gateway 路由配置设计

### 7.1 路由规则

```yaml
spring:
  cloud:
    gateway:
      routes:
        # 1. 静态资源路由（前端页面）
        - id: frontend-static
          uri: file:./src/main/resources/static
          predicates:
            - Path=/static/**
          filters:
            - StripPrefix=1
        
        # 2. 首页路由
        - id: homepage
          uri: file:./src/main/resources/static
          predicates:
            - Path=/
          filters:
            - RewritePath=/index.html
        
        # 3. SPA 路由支持（未来 React）
        - id: frontend-spa
          uri: file:./src/main/resources/static
          predicates:
            - Path=/lobby, /game/**, /profile/**
          filters:
            - RewritePath=/index.html
        
        # 4. API 路由
        - id: game-service-api
          uri: http://localhost:8081
          predicates:
            - Path=/api/game/**
          filters:
            - StripPrefix=1
        
        - id: system-service-api
          uri: http://localhost:8082
          predicates:
            - Path=/api/system/**
          filters:
            - StripPrefix=1
```

### 7.2 安全配置

```java
http.authorizeExchange(ex -> ex
    // 公开页面（无需登录）
    .pathMatchers("/", "/about", "/profile/*/public").permitAll()
    .pathMatchers("/static/**", "/css/**", "/js/**").permitAll()
    
    // 登录相关
    .pathMatchers("/login", "/oauth2/**").permitAll()
    
    // 需要登录的页面
    .pathMatchers("/lobby", "/game/**", "/profile").authenticated()
    
    // API 路由
    .pathMatchers("/api/**").authenticated()
    
    .anyExchange().authenticated()
);
```

---

## 📝 八、实施计划

### 8.1 第一阶段：页面重构（1-2 周）

1. **创建首页 (`index.html`)**
   - 设计首页布局（未登录/已登录状态）
   - 实现游戏列表展示
   - 实现登录入口和引导

2. **重构游戏大厅 (`lobby.html`)**
   - 明确职责：创建/加入房间
   - 移除首页相关功能
   - 优化登录状态检查

3. **迁移前端资源**
   - 将前端页面从 `game-service/static` 迁移到 `gateway/static`
   - 更新所有资源路径引用
   - 配置 Gateway 路由

4. **实现渐进式登录**
   - 首页允许未登录访问
   - 游戏大厅需要登录
   - 实现登录状态检查和跳转

### 8.2 第二阶段：功能完善（按需）

1. **个人中心页面**
   - 用户信息展示
   - 战绩记录
   - 设置页面

2. **关于页面**
   - 平台介绍
   - 游戏规则说明
   - 联系方式

3. **优化用户体验**
   - 加载状态提示
   - 错误处理
   - 响应式设计

---

## ✅ 九、总结

### 9.1 核心设计决策

1. **登录策略**：渐进式登录（首页可浏览，核心功能需登录）
2. **页面划分**：首页 / 游戏大厅 / 游戏房间 / 个人中心
3. **架构方案**：当前 Gateway 静态资源服务，未来独立前端服务
4. **路由设计**：清晰的路径规划，支持 SPA 路由

### 9.2 下一步行动

1. ✅ 创建首页设计文档
2. ✅ 迁移前端资源到 Gateway
3. ✅ 实现渐进式登录策略
4. ✅ 更新 Gateway 路由配置

---

> 💡 **建议**：先完成页面流程设计和首页实现，再考虑前端框架迁移。这样可以确保架构设计正确，避免后续重构。



