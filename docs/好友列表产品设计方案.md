# 好友列表产品设计方案

## 一、产品定位分析

### 1.1 用户核心需求
- **快速找到好友并发起聊天**（最高频）
- **查看好友在线状态**（高频）
- **邀请好友一起游戏**（中频）
- **管理好友关系**（低频，但重要）

### 1.2 使用场景
1. **游戏房间内**：想邀请好友一起玩
2. **大厅等待时**：想找好友聊天或组队
3. **个人中心**：查看和管理所有好友
4. **聊天时**：快速选择好友发起私聊

## 二、位置方案对比

### 方案A：独立页面（/friends）
**优点**：
- 空间充足，可展示详细信息
- 适合深度管理（分组、搜索、排序）
- 符合用户对"好友列表"的认知

**缺点**：
- 入口较深，需要2-3步才能到达
- 与聊天场景割裂，需要跳转

**适用场景**：好友数量较多（50+），需要复杂管理功能

---

### 方案B：个人中心Tab
**优点**：
- 与个人资料关联，逻辑清晰
- 已有入口（ProfileHome 的"查看好友列表"按钮）
- 可展示好友详细信息

**缺点**：
- 入口仍然较深
- 与聊天场景分离

**适用场景**：作为管理入口，配合其他快速入口使用

---

### 方案C：Header下拉菜单
**优点**：
- 全局可见，入口浅
- 快速访问

**缺点**：
- 空间有限，只能展示少量好友
- 下拉菜单已用于用户信息，功能重叠

**适用场景**：作为快捷入口，展示最近联系的好友（3-5个）

---

### 方案D：GlobalChat集成（推荐⭐）
**优点**：
- **与聊天场景完美结合**，符合用户习惯（类似微信/QQ）
- 点击好友即可发起聊天，流程最短
- 可展示在线状态、未读消息数
- 支持搜索、分组

**缺点**：
- 需要改造 GlobalChat 组件
- 如果好友很多，列表可能较长

**适用场景**：主要聊天入口，适合大多数用户

---

### 方案E：侧边栏（类似Discord）
**优点**：
- 全局可见，不占用主内容区
- 可展示完整好友列表
- 支持分组、在线状态

**缺点**：
- 需要改造整体布局
- 移动端体验较差

**适用场景**：桌面端为主的产品

---

## 三、推荐方案：混合方案

### 3.1 核心设计
采用 **"GlobalChat集成 + 个人中心完整管理"** 的混合方案：

#### 主入口：GlobalChat 侧边栏
- **位置**：GlobalChat 左侧或顶部Tab
- **功能**：
  - 好友列表（带在线状态）
  - 最近聊天记录
  - 搜索好友
  - 快速发起聊天

#### 管理入口：个人中心页面
- **位置**：ProfilePage 的"查看好友列表"按钮
- **功能**：
  - 完整好友列表
  - 好友管理（删除、备注、分组）
  - 好友申请管理
  - 好友统计信息

### 3.2 具体实现

#### 3.2.1 GlobalChat 改造
```
GlobalChat 布局：
┌─────────────────────────────────────┐
│  [好友列表] [最近聊天] [系统消息]    │  ← Tab切换
├──────────┬──────────────────────────┤
│          │                          │
│ 好友列表 │      聊天内容区           │
│          │                          │
│ - 在线   │                          │
│  好友1   │                          │
│  好友2   │                          │
│          │                          │
│ - 离线   │                          │
│  好友3   │                          │
│          │                          │
└──────────┴──────────────────────────┘
```

**功能点**：
1. **好友列表Tab**：
   - 显示所有好友（按在线状态分组：在线/离线）
   - 显示在线状态指示器（绿色圆点）
   - 显示未读消息数（红色角标）
   - 点击好友 → 切换到私聊会话
   - 支持搜索框

2. **最近聊天Tab**（现有功能）：
   - 保持现有逻辑

3. **系统消息Tab**（可选）：
   - 系统通知、好友申请等

#### 3.2.2 个人中心好友管理页面
```
路由：/friends
功能：
- 完整好友列表（支持搜索、排序）
- 好友卡片展示（头像、昵称、在线状态、最后互动时间）
- 操作按钮：发消息、查看资料、删除好友、设置备注
- 统计信息：好友总数、在线好友数
- 好友申请管理（待处理申请列表）
```

### 3.3 交互流程

#### 场景1：快速找好友聊天
1. 用户打开 GlobalChat
2. 点击"好友列表"Tab
3. 看到所有好友（在线优先显示）
4. 点击好友 → 自动切换到私聊会话
5. 开始聊天

**步骤数**：2步（打开聊天 → 选择好友）

#### 场景2：管理好友
1. 用户进入个人中心
2. 点击"查看好友列表"按钮
3. 进入好友管理页面
4. 进行管理操作（删除、备注等）

**步骤数**：3步（个人中心 → 好友列表 → 操作）

#### 场景3：邀请好友游戏
1. 用户在游戏房间
2. 点击"邀请好友"按钮
3. 弹出好友选择器（从好友列表选择）
4. 发送邀请

**步骤数**：2步（邀请 → 选择好友）

## 四、技术实现要点

### 4.1 后端API需求
需要新增以下接口：

1. **GET /api/friends** - 获取好友列表
   ```json
   Response: {
     "code": 200,
     "data": [
       {
         "friendId": "uuid",
         "friendNickname": "备注名",
         "friendGroup": "分组",
         "isFavorite": false,
         "lastInteractionTime": "2024-01-01T00:00:00Z",
         "friendInfo": {
           "userId": "uuid",
           "nickname": "昵称",
           "username": "用户名",
           "avatarUrl": "头像URL",
           "playerId": "玩家ID",
           "online": true  // 在线状态（需要从chat-service获取）
         }
       }
     ]
   }
   ```

2. **GET /api/friends/{friendId}** - 获取单个好友详情

3. **PUT /api/friends/{friendId}** - 更新好友信息（备注、分组等）

4. **DELETE /api/friends/{friendId}** - 删除好友

### 4.2 前端组件结构
```
components/
  ├── chat/
  │   ├── GlobalChat.jsx (改造)
  │   ├── FriendListTab.jsx (新增)
  │   └── FriendListItem.jsx (新增)
  └── friends/
      ├── FriendsPage.jsx (新增)
      ├── FriendCard.jsx (新增)
      └── FriendManagement.jsx (新增)
```

### 4.3 在线状态获取
- **方案1**：从 chat-service 获取在线用户列表，前端匹配
- **方案2**：后端聚合 chat-service 的在线状态
- **方案3**：WebSocket 推送在线状态变化

## 五、优先级建议

### Phase 1：MVP（最小可行产品）
1. ✅ 后端：GET /api/friends 接口
2. ✅ 前端：个人中心好友列表页面（/friends）
3. ✅ 前端：好友卡片展示（头像、昵称、操作按钮）

### Phase 2：核心功能
1. ✅ GlobalChat 集成好友列表Tab
2. ✅ 在线状态显示
3. ✅ 快速发起聊天

### Phase 3：增强功能
1. ✅ 好友搜索
2. ✅ 好友分组
3. ✅ 好友备注
4. ✅ 删除好友

### Phase 4：高级功能
1. ⏳ 好友推荐
2. ⏳ 最近互动排序
3. ⏳ 好友统计面板

## 六、UI/UX 建议

### 6.1 视觉设计
- **在线状态**：绿色圆点（在线）、灰色圆点（离线）
- **未读消息**：红色角标（数字）
- **好友卡片**：头像 + 昵称 + 在线状态 + 操作按钮
- **空状态**：友好的提示文案和引导

### 6.2 交互细节
- **加载状态**：骨架屏或加载动画
- **错误处理**：友好的错误提示
- **响应式**：移动端适配（列表可滑动）

### 6.3 性能优化
- **虚拟滚动**：好友数量多时使用虚拟列表
- **分页加载**：好友列表分页加载
- **缓存策略**：好友列表缓存，定期刷新

## 七、总结

**推荐方案**：GlobalChat集成 + 个人中心管理页面

**理由**：
1. ✅ 符合用户习惯（类似微信/QQ）
2. ✅ 使用流程最短（2步即可发起聊天）
3. ✅ 功能完整（快速入口 + 深度管理）
4. ✅ 技术实现成本适中
5. ✅ 可扩展性强（后续可添加分组、搜索等）

**实施建议**：
- 先实现个人中心的好友列表页面（Phase 1）
- 再改造 GlobalChat 集成好友列表（Phase 2）
- 逐步完善功能（Phase 3-4）


