server:
  port: 8081
spring:
  application:
    name: game-service
  security:
    oauth2:
      resourceserver:
        jwt:
          # 如果服务运行在宿主机，保持 127.0.0.1；
          # 如果运行在容器中，请改为实际可达地址（例如 http://keycloak:8180）
          issuer-uri: http://127.0.0.1:8180/realms/my-realm
  jackson:
    serialization:
      INDENT_OUTPUT: true
  data:
    redis:
      host: 127.0.0.1
      port: 6379
      password: zaqxsw
      database: 2
      timeout: 2s
      lettuce:
        pool:
          max-active: 16
          max-idle: 8
          min-idle: 0
          max-wait: 5s
  # Spring Cloud LoadBalancer 配置（服务发现与负载均衡）
  # 说明：
  #  1. LoadBalancer 会根据 FeignClient 的 name 属性（"system-service"）查找对应的服务实例
  #  2. 本地开发：通过 SimpleDiscoveryClient 配置服务实例地址
  #  3. Docker Compose：容器 DNS 自动解析服务名（无需配置）
  #  4. Kubernetes：K8s Service + DNS 自动解析服务名（无需配置）
  cloud:
    loadbalancer:
      enabled: true
    discovery:
      client:
        simple:
          instances:
            system-service:
              - uri: http://127.0.0.1:8082
              # 多实例示例（取消注释以启用）：
              # - uri: http://127.0.0.1:8083

# session会话管理redis（所有服务统一用 database 0）
session:
  redis:
    host: 127.0.0.1
    port: 6379
    database: ${SESSION_REDIS_DATABASE:0}
    password: zaqxsw
  # Kafka 会话失效事件通知
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    topic: session-invalidated
    consumer:
      group-id: game-service-session-group

scheduler:
  clock:
    corePoolSize: 2

gomoku:
  pve:
    auto-ai: false
  turn:
    seconds: 30    # 回合时长（秒），默认 30
    aiTimed: false # AI 回合是否计时，默认不计时
logging:
  level:
    org.springframework.security: INFO
    com.gamehub.gameservice.platform.ws: INFO  # WebSocket 断开检测日志
    com.gamehub.session: DEBUG  # SessionRegistry 日志（可选，用于调试）

# 兼容旧配置（保留，用于向后兼容）
# 注意：如果使用 LoadBalancer，优先使用上面的 spring.cloud.loadbalancer.clients 配置
system-service:
  url: http://127.0.0.1:8082

# Resilience4j 熔断器配置（用于 Feign 调用 xxxx-service 的容错）
resilience4j:
  circuitbreaker:
    instances:
      systemUserClient:  # 对应 @CircuitBreaker(name = "systemUserClient")
        slidingWindowSize: 20  # 滑动窗口大小（统计最近 N 次调用）
        failureRateThreshold: 50  # 失败率阈值（超过 50% 触发熔断）
        waitDurationInOpenState: 10s  # 熔断后等待时间（10秒后进入半开状态）
        permittedNumberOfCallsInHalfOpenState: 3  # 半开状态允许的试探调用次数
